<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Sinema ULTRA - Watch Party</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    
    <!-- Adaptive Streaming (ABR): HLS.js + dash.js -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@1.6.15/dist/hls.min.js"></script>
    <script src="https://cdn.dashjs.org/v5.1.1/modern/umd/dash.all.min.js"></script>
    
    <!-- WebTorrent P2P -->
    <script src="https://cdn.jsdelivr.net/npm/webtorrent@latest/webtorrent.min.js"></script>
    
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- UI Overlay - Oda OluÅŸturma/Listesi -->
    <div id="ui-overlay">
        <div class="container">
            <h1>ğŸ¬ Sinema ULTRA</h1>
            <p class="subtitle">Watch Party - Birlikte Ä°zle</p>
            
            <div id="create-room-section">
                <div class="input-group">
                    <label>Oda AdÄ±</label>
                    <input type="text" id="room-name" placeholder="Ã–zel film gecesi">
                </div>
                
                <!-- Video Source Tabs -->
                <div class="input-group">
                    <label>Video KaynaÄŸÄ±</label>
                    <div class="video-source-tabs">
                        <button type="button" id="tab-url" class="active" onclick="switchVideoSourceTab('url')">ğŸ”— URL</button>
                        <button type="button" id="tab-local" onclick="switchVideoSourceTab('local')">ğŸ“ P2P</button>
                        <button type="button" id="tab-youtube" onclick="switchVideoSourceTab('youtube')">â–¶ï¸ YouTube</button>
                    </div>
                </div>
                
                <!-- URL Section -->
                <div id="url-section">
                    <div class="input-group">
                        <label>Video URL</label>
                        <input type="text" id="video-url" placeholder="MP4, HLS (.m3u8), DASH (.mpd) linki">
                    </div>
                </div>
                
                <!-- Local File Section (P2P) -->
                <div id="local-file-section">
                    <div class="input-group">
                        <div class="file-drop-zone" id="file-drop-zone" onclick="document.getElementById('local-video-file').click()">
                            <div>ğŸ“ Dosya seÃ§mek iÃ§in tÄ±klayÄ±n veya sÃ¼rÃ¼kleyip bÄ±rakÄ±n</div>
                            <div style="font-size: 12px; opacity: 0.7; margin-top: 8px;">MP4, WebM, MKV desteklenir</div>
                            <input type="file" id="local-video-file" accept="video/*">
                            <div id="selected-file-name"></div>
                        </div>
                    </div>
                    <div style="font-size: 12px; opacity: 0.8; margin-bottom: 15px;">
                        âš¡ P2P: Video dosyanÄ±z doÄŸrudan arkadaÅŸlarÄ±nÄ±za aktarÄ±lÄ±r. TarayÄ±cÄ± aÃ§Ä±k kalmalÄ±dÄ±r.
                    </div>
                </div>
                
                <!-- YouTube Section -->
                <div id="youtube-section">
                    <div class="input-group">
                        <label>YouTube URL (Ä°steÄŸe BaÄŸlÄ±)</label>
                        <input type="text" id="youtube-url" placeholder="https://www.youtube.com/watch?v=VIDEO_ID">
                    </div>
                    <div class="youtube-info-box">
                        <div>â„¹ï¸ <strong>YouTube Modu Bilgisi:</strong></div>
                        <ul>
                            <li>âœ… <strong>URL girmeden de oda aÃ§abilirsiniz!</strong> Oda iÃ§inde arama yaparak video seÃ§ebilirsiniz.</li>
                            <li>âœ… Senkronize watch party Ã§alÄ±ÅŸÄ±r</li>
                            <li>âš ï¸ BazÄ± videolar gÃ¶mÃ¼lmeye izin vermeyebilir</li>
                        </ul>
                    </div>
                </div>
                
                <div class="input-group">
                    <label>AÃ§Ä±klama (isteÄŸe baÄŸlÄ±)</label>
                    <textarea id="room-description" placeholder="Bu odada ne izlenecek?"></textarea>
                </div>
                
                <!-- Åifre KorumasÄ± (Opsiyonel) -->
                <div class="input-group">
                    <label>ğŸ”’ Oda Åifresi (isteÄŸe baÄŸlÄ±)</label>
                    <input type="password" id="room-password" placeholder="BoÅŸ bÄ±rakÄ±lÄ±rsa herkes girebilir">
                    <div class="password-hint">Åifre korumalÄ± odalar ğŸ”’ ikonu ile gÃ¶rÃ¼nÃ¼r</div>
                </div>
                
                <div class="input-group">
                    <label>Kalite Limiti</label>
                    <select id="screen-size">
                        <option value="medium">Orta (480p)</option>
                        <option value="large" selected>YÃ¼ksek (720p)</option>
                        <option value="imax">Maksimum</option>
                    </select>
                </div>
                
                <!-- Environment seÃ§imi kaldÄ±rÄ±ldÄ± (VR yoksa gereksiz) -->
                <input type="hidden" id="environment" value="none">
                
                <button onclick="createRoom()">ğŸš€ Oda OluÅŸtur ve KatÄ±l</button>
                <button onclick="showRoomList()">ğŸ“‹ Mevcut Odalar</button>
            </div>
            
            <div id="room-list-section" class="hidden">
                <button onclick="showCreateRoom()">â† Geri</button>
                <div id="room-list"></div>
            </div>
        </div>
    </div>
    
    <!-- Video Player Container (2D Mode) -->
    <div id="video-container" class="hidden">
        <!-- Header -->
        <div class="video-header">
            <div class="video-room-info">
                <span id="video-room-name"></span>
                <span id="video-viewer-count"></span>
            </div>
            <div class="video-sync-status">
                <span id="sync-text">âœ… Senkronize</span>
            </div>
        </div>
        
        <!-- Video Player Wrapper -->
        <div class="video-player-wrapper">
            <video id="video-player" playsinline webkit-playsinline></video>
            
            <!-- Buffer Countdown Overlay -->
            <div id="buffer-countdown" class="video-overlay"></div>
            
            <!-- Sync Countdown Overlay -->
            <div id="sync-countdown" class="video-overlay"></div>
        </div>
        
        <!-- Video Controls -->
        <div class="video-controls">
            <!-- Progress Bar -->
            <div class="video-progress-container">
                <div class="video-progress-bar" id="video-progress-bar">
                    <div class="video-progress-fill" id="video-progress-fill"></div>
                    <div class="video-progress-handle" id="video-progress-handle"></div>
                </div>
                <div class="video-time-info">
                    <span id="video-current-time">0:00</span>
                    <span id="video-duration">0:00</span>
                </div>
            </div>
            
            <!-- Control Buttons -->
            <div class="video-control-buttons">
                <div class="control-group-left">
                    <button id="btn-play" onclick="playVideo()" title="Oynat">â–¶ï¸</button>
                    <button id="btn-pause" onclick="pauseVideo()" title="Duraklat">â¸ï¸</button>
                    <button id="btn-stop" onclick="stopVideo()" title="Durdur">â¹ï¸</button>
                    <button id="btn-rewind" onclick="seekBackward()" title="-10 saniye">âª</button>
                    <button id="btn-forward" onclick="seekForward()" title="+10 saniye">â©</button>
                </div>
                
                <div class="control-group-center">
                    <button id="btn-sync" onclick="initiateSync()" title="Senkronize Et">ğŸ”„ Sync</button>
                </div>
                
                <div class="control-group-right">
                    <!-- Volume Control -->
                    <div class="volume-control">
                        <button id="btn-mute" onclick="toggleMute()" title="Sessiz">ğŸ”Š</button>
                        <input type="range" id="volume-slider" min="0" max="1" step="0.1" value="1" onchange="setVolume(this.value)">
                    </div>
                    
                    <!-- Quality Control -->
                    <div class="quality-control">
                        <button id="btn-quality-down" onclick="decreaseMaxQuality()" title="Kalite DÃ¼ÅŸÃ¼r">ğŸ“‰</button>
                        <span id="quality-cap-label">720p</span>
                        <button id="btn-quality-up" onclick="increaseMaxQuality()" title="Kalite ArtÄ±r">ğŸ“ˆ</button>
                    </div>
                    
                    <!-- Fullscreen -->
                    <button id="btn-fullscreen" onclick="toggleFullscreen()" title="Tam Ekran">â›¶</button>
                </div>
            </div>
            
            <!-- Bottom Controls -->
            <div class="video-control-bottom">
                <button id="btn-request-ownership" onclick="sendOwnershipRequest()">ğŸ™‹ Sahiplik Ä°ste</button>
                <button onclick="leaveRoom()">ğŸšª Ã‡Ä±k</button>
            </div>
        </div>
    </div>
    
    <!-- P2P Status -->
    <div id="p2p-status">
        <div id="p2p-status-text">P2P BaÄŸlantÄ±sÄ±...</div>
        <div id="p2p-progress-bar">
            <div id="p2p-progress-fill"></div>
        </div>
        <div id="p2p-stats"></div>
    </div>
    
    <!-- Legacy elements for backward compatibility -->
    <div id="room-info" style="display:none;">
        <div id="room-name-display"></div>
        <div id="viewer-count"></div>
    </div>
    <div id="sync-status" style="display:none;"></div>
    <div id="vr-controls" style="display:none;"></div>
    <div id="buffer-timer" style="display:none;"></div>

<script>
const v = new Date().getTime();
document.write('<script src="ytapi.js?v=' + v + '"><' + '/script>');
document.write('<script src="js01.js?v=' + v + '"><' + '/script>');
document.write('<script src="js02-01.js?v=' + v + '"><' + '/script>');
document.write('<script src="js02-02.js?v=' + v + '"><' + '/script>');
document.write('<script src="js03.js?v=' + v + '"><' + '/script>');
document.write('<script src="js04.js?v=' + v + '"><' + '/script>');
document.write('<script src="js05.js?v=' + v + '"><' + '/script>');
document.write('<script src="js06.js?v=' + v + '"><' + '/script>');
document.write('<script src="js07.js?v=' + v + '"><' + '/script>');
document.write('<script src="js08.js?v=' + v + '"><' + '/script>');
document.write('<script src="js09.js?v=' + v + '"><' + '/script>');
document.write('<script src="js10.js?v=' + v + '"><' + '/script>');
document.write('<script src="js11.js?v=' + v + '"><' + '/script>');
document.write('<script src="js12.js?v=' + v + '"><' + '/script>');
document.write('<script src="js13.js?v=' + v + '"><' + '/script>');
document.write('<script src="js14.js?v=' + v + '"><' + '/script>');
document.write('<script src="js15.js?v=' + v + '"><' + '/script>');
document.write('<script src="js16.js?v=' + v + '"><' + '/script>');
document.write('<script src="js17.js?v=' + v + '"><' + '/script>');
document.write('<script src="js18.js?v=' + v + '"><' + '/script>');
document.write('<script src="js19.js?v=' + v + '"><' + '/script>');
document.write('<script src="js20.js?v=' + v + '"><' + '/script>');
document.write('<script src="js21.js?v=' + v + '"><' + '/script>');
document.write('<script src="js22.js?v=' + v + '"><' + '/script>');
document.write('<script src="js23.js?v=' + v + '"><' + '/script>');
document.write('<script src="js24-01.js?v=' + v + '"><' + '/script>');
document.write('<script src="js24-02.js?v=' + v + '"><' + '/script>');
document.write('<script src="js25.js?v=' + v + '"><' + '/script>');
document.write('<script src="js26.js?v=' + v + '"><' + '/script>');
document.write('<script src="js27.js?v=' + v + '"><' + '/script>');
document.write('<script src="js28-01-01.js?v=' + v + '"><' + '/script>');
document.write('<script src="js28-01-02.js?v=' + v + '"><' + '/script>');
document.write('<script src="js28-01-03.js?v=' + v + '"><' + '/script>');
document.write('<script src="js28-02.js?v=' + v + '"><' + '/script>');
document.write('<script src="js29-01.js?v=' + v + '"><' + '/script>');
document.write('<script src="js29-02.js?v=' + v + '"><' + '/script>');
document.write('<script src="js30.js?v=' + v + '"><' + '/script>');
document.write('<script src="js31.js?v=' + v + '"><' + '/script>');
document.write('<script src="js32-01.js?v=' + v + '"><' + '/script>');
document.write('<script src="js32-02.js?v=' + v + '"><' + '/script>');
document.write('<script src="js33.js?v=' + v + '"><' + '/script>');
document.write('<script src="js34.js?v=' + v + '"><' + '/script>');
document.write('<script src="js35.js?v=' + v + '"><' + '/script>');
document.write('<script src="js36.js?v=' + v + '"><' + '/script>');
document.write('<script src="js37.js?v=' + v + '"><' + '/script>');
document.write('<script src="js38.js?v=' + v + '"><' + '/script>');
document.write('<script src="js39.js?v=' + v + '"><' + '/script>');
document.write('<script src="js40-01.js?v=' + v + '"><' + '/script>');
document.write('<script src="js40-02.js?v=' + v + '"><' + '/script>');
document.write('<script src="js40-03.js?v=' + v + '"><' + '/script>');
document.write('<script src="js42-01-01.js?v=' + v + '"><' + '/script>');
document.write('<script src="js42-01-02.js?v=' + v + '"><' + '/script>');
document.write('<script src="js42-01-03.js?v=' + v + '"><' + '/script>');
document.write('<script src="js42-01-04.js?v=' + v + '"><' + '/script>');
document.write('<script src="js42-02-01.js?v=' + v + '"><' + '/script>');
document.write('<script src="js42-02-02.js?v=' + v + '"><' + '/script>');
document.write('<script src="js42-02-03.js?v=' + v + '"><' + '/script>');
document.write('<script src="js44-01-01.js?v=' + v + '"><' + '/script>');
document.write('<script src="js44-01-02.js?v=' + v + '"><' + '/script>');
document.write('<script src="js44-01-03.js?v=' + v + '"><' + '/script>');
document.write('<script src="js44-01-04.js?v=' + v + '"><' + '/script>');
document.write('<script src="js44-02.js?v=' + v + '"><' + '/script>');
document.write('<script src="js44-03-01.js?v=' + v + '"><' + '/script>');
document.write('<script src="js44-03-02.js?v=' + v + '"><' + '/script>');
document.write('<script src="js44-04-01.js?v=' + v + '"><' + '/script>');
document.write('<script src="js44-04-02.js?v=' + v + '"><' + '/script>');
document.write('<script src="js44-04-03.js?v=' + v + '"><' + '/script>');
document.write('<script src="js44-04-04.js?v=' + v + '"><' + '/script>');
document.write('<script src="js44-05.js?v=' + v + '"><' + '/script>');
document.write('<script src="js45-01.js?v=' + v + '"><' + '/script>');
document.write('<script src="js45-02.js?v=' + v + '"><' + '/script>');
document.write('<script src="js45-03.js?v=' + v + '"><' + '/script>');
document.write('<script src="js45-04.js?v=' + v + '"><' + '/script>');
document.write('<script src="js46.js?v=' + v + '"><' + '/script>');
</script>
</body> 
</html>
